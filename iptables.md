# Iptables setup

# Allow loopback connections (localhost)
```
sudo iptables -A INPUT -i lo -j ACCEPT
sudo iptables -A OUTPUT -o lo -j ACCEPT
```

# Allow established tcp connections
```
sudo iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
```

## Allow outgoing udp
```
sudo iptables -A INPUT -p udp --sport 53 -m state --state ESTABLISHED -j ACCEPT
```

## Allow ssh
```
sudo iptables -A INPUT -p tcp --dport 22 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT
sudo iptables -A OUTPUT -p tcp --sport 22 -m conntrack --ctstate ESTABLISHED -j ACCEPT
```

## Persistent setup

Install 
```
apt install iptables-persistent
```

Save the following to `/etc/iptables/rules.v4` and `/etc/iptables/rules.v6`

Either via `iptables-save > /etc/iptables/rules.v6` and `iptables-save > /etc/iptables/rules.v4`
or copy the following file:
```
# Generated by iptables-save v1.6.0 on Sun Feb  3 02:42:47 2019
*filter
:INPUT DROP [15:2068]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
-A INPUT -p udp -m udp --dport 13337 -j ACCEPT
-A INPUT -p icmp -j ACCEPT
-A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A INPUT -i lo -j ACCEPT
-A INPUT -i lo -j ACCEPT
-A INPUT -p udp -m udp --sport 53 -m state --state ESTABLISHED -j ACCEPT
-A OUTPUT -o lo -j ACCEPT
-A OUTPUT -o lo -j ACCEPT
COMMIT
# Completed on Sun Feb  3 02:42:47 2019
```

### Restore setup (close all client connections)
```
iptables-restore </etc/iptables/rules.v4
iptables-restore </etc/iptables/rules.v6
```